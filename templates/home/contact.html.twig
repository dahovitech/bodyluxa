{% extends 'base.html.twig' %}

{% block title %}{{ 'contact_us'|trans }} - {{ config.getWebsiteTitle() }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/styles/modern.css') }}">
{% endblock %}

{% block body %}

<!-- Hero Section -->
<section class="hero-section py-5">
    <div class="container">
        <div class="row align-items-center min-vh-50">
            <div class="col-lg-6" data-aos="fade-right">
                <h1 class="display-4 fw-bold mb-4 font-playfair">{{ 'contact_us'|trans }}</h1>
                <p class="lead">{{ 'contact_subtitle'|trans }}</p>
            </div>
            <div class="col-lg-6" data-aos="fade-left">
                <img src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                     alt="Contact" class="img-fluid rounded-3 floating">
            </div>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section class="py-5">
    <div class="container">
        <div class="row g-5">
            <!-- Contact Form -->
            <div class="col-lg-8" data-aos="fade-up">
                <div class="card-modern">
                    <div class="card-body p-4">
                        <h3 class="font-playfair mb-4">{{ 'send_message'|trans }}</h3>
                        
                        <!-- Alert for form responses -->
                        <div id="formAlert" class="alert d-none" role="alert"></div>
                        
                        <form id="contactForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="firstName" class="form-label">{{ 'first_name'|trans }} *</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="lastName" class="form-label">{{ 'last_name'|trans }} *</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">{{ 'email'|trans }} *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">{{ 'phone'|trans }}</label>
                                    <input type="tel" class="form-control" id="phone" name="phone">
                                </div>
                                <div class="col-12">
                                    <label for="service" class="form-label">{{ 'interested_service'|trans }}</label>
                                    <select class="form-select" id="service" name="service">
                                        <option value="">{{ 'select_service'|trans }}</option>
                                        <option value="hair-transplant">{{ 'hair_transplant'|trans }}</option>
                                        <option value="plastic-surgery">{{ 'plastic_surgery'|trans }}</option>
                                        <option value="dental-care">{{ 'dental_care'|trans }}</option>
                                        <option value="aesthetic-treatments">{{ 'aesthetic_treatments'|trans }}</option>
                                        <option value="other">{{ 'other'|trans }}</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label for="message" class="form-label">{{ 'message'|trans }} *</label>
                                    <textarea class="form-control" id="message" name="message" rows="5" required 
                                              placeholder="{{ 'message_placeholder'|trans }}"></textarea>
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="consent" name="consent" required>
                                        <label class="form-check-label" for="consent">
                                            {{ 'privacy_consent'|trans }}
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-gradient btn-lg w-100" id="submitBtn">
                                        <i class="fas fa-paper-plane me-2"></i>
                                        {{ 'send_message'|trans }}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Quick Quote Section -->
                <div class="card-modern mt-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-body p-4">
                        <h4 class="font-playfair mb-4">{{ 'quick_quote'|trans }}</h4>
                        
                        <div id="quoteAlert" class="alert d-none" role="alert"></div>
                        
                        <form id="quoteForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="quoteName" class="form-label">{{ 'full_name'|trans }} *</label>
                                    <input type="text" class="form-control" id="quoteName" name="name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="quoteEmail" class="form-label">{{ 'email'|trans }} *</label>
                                    <input type="email" class="form-control" id="quoteEmail" name="email" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="quoteService" class="form-label">{{ 'service'|trans }} *</label>
                                    <select class="form-select" id="quoteService" name="service" required>
                                        <option value="">{{ 'select_service'|trans }}</option>
                                        <option value="hair-transplant" data-price="2500">{{ 'hair_transplant'|trans }}</option>
                                        <option value="plastic-surgery" data-price="3000">{{ 'plastic_surgery'|trans }}</option>
                                        <option value="dental-care" data-price="1500">{{ 'dental_care'|trans }}</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="quotePackage" class="form-label">{{ 'package'|trans }} *</label>
                                    <select class="form-select" id="quotePackage" name="package" required>
                                        <option value="">{{ 'select_package'|trans }}</option>
                                        <option value="basic" data-multiplier="1">{{ 'basic_package'|trans }}</option>
                                        <option value="premium" data-multiplier="1.5">{{ 'premium_package'|trans }}</option>
                                        <option value="vip" data-multiplier="2">{{ 'vip_package'|trans }}</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <div class="price-result" id="quotePrice" style="display: none;">
                                        <span>{{ 'estimated_price'|trans }}: €<span id="quoteFinalPrice">0</span></span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-outline-primary btn-lg w-100" id="quoteBtn">
                                        <i class="fas fa-calculator me-2"></i>
                                        {{ 'get_quote'|trans }}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Contact Info -->
            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
                <!-- Contact Details -->
                <div class="card-modern mb-4">
                    <div class="card-body">
                        <h4 class="font-playfair mb-4">{{ 'contact_info'|trans }}</h4>
                        
                        <div class="contact-item mb-4">
                            <div class="d-flex align-items-start">
                                <div class="contact-icon me-3">
                                    <i class="fas fa-map-marker-alt text-primary"></i>
                                </div>
                                <div>
                                    <h6>{{ 'address'|trans }}</h6>
                                    <p class="text-muted mb-0">
                                        Istanbul Medical Center<br>
                                        Şişli, Istanbul, Turkey
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="contact-item mb-4">
                            <div class="d-flex align-items-start">
                                <div class="contact-icon me-3">
                                    <i class="fas fa-phone text-primary"></i>
                                </div>
                                <div>
                                    <h6>{{ 'phone'|trans }}</h6>
                                    <p class="mb-0">
                                        <a href="tel:+905551234567" class="text-decoration-none">
                                            +90 555 123 45 67
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="contact-item mb-4">
                            <div class="d-flex align-items-start">
                                <div class="contact-icon me-3">
                                    <i class="fas fa-envelope text-primary"></i>
                                </div>
                                <div>
                                    <h6>{{ 'email'|trans }}</h6>
                                    <p class="mb-0">
                                        <a href="mailto:info@bodyluxa.com" class="text-decoration-none">
                                            info@bodyluxa.com
                                        </a>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="contact-item">
                            <div class="d-flex align-items-start">
                                <div class="contact-icon me-3">
                                    <i class="fas fa-clock text-primary"></i>
                                </div>
                                <div>
                                    <h6>{{ 'working_hours'|trans }}</h6>
                                    <p class="text-muted mb-0">
                                        {{ 'mon_fri'|trans }}: 09:00 - 18:00<br>
                                        {{ 'saturday'|trans }}: 09:00 - 16:00<br>
                                        {{ 'sunday'|trans }}: {{ 'closed'|trans }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Social Media -->
                <div class="card-modern mb-4">
                    <div class="card-body text-center">
                        <h5 class="font-playfair mb-3">{{ 'follow_us'|trans }}</h5>
                        <div class="d-flex justify-content-center gap-3">
                            <a href="#" class="btn btn-outline-primary btn-sm rounded-circle">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="btn btn-outline-primary btn-sm rounded-circle">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="btn btn-outline-primary btn-sm rounded-circle">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="btn btn-outline-primary btn-sm rounded-circle">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Emergency Contact -->
                <div class="card-modern">
                    <div class="card-body text-center bg-primary text-white">
                        <h5 class="font-playfair mb-3">{{ 'emergency_contact'|trans }}</h5>
                        <p class="mb-3">{{ 'available_24_7'|trans }}</p>
                        <a href="https://wa.me/905551234567" class="btn btn-light btn-lg">
                            <i class="fab fa-whatsapp me-2"></i>
                            {{ 'whatsapp_now'|trans }}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Map Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12" data-aos="fade-up">
                <h3 class="text-center font-playfair mb-4">{{ 'find_us'|trans }}</h3>
                <div class="map-container" style="height: 400px; border-radius: 15px; overflow: hidden;">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3009.654122680827!2d28.9784!3d41.0534!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cab7650656bd63%3A0x8ca058b28c20b6c3!2sSisli%2C%20Istanbul%2C%20Turkey!5e0!3m2!1sen!2sus!4v1234567890123!5m2!1sen!2sus"
                        width="100%" 
                        height="100%" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Contact Form Handler
            const contactForm = document.getElementById('contactForm');
            const formAlert = document.getElementById('formAlert');
            const submitBtn = document.getElementById('submitBtn');

            contactForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Get form data
                const formData = new FormData(contactForm);
                const data = {
                    name: `${formData.get('firstName')} ${formData.get('lastName')}`,
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    service: formData.get('service'),
                    message: formData.get('message')
                };

                // Update button state
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>{{ 'sending'|trans }}...';

                try {
                    const response = await fetch('/api/contact', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        showAlert(formAlert, 'success', result.message);
                        contactForm.reset();
                    } else {
                        showAlert(formAlert, 'danger', result.message);
                    }
                } catch (error) {
                    showAlert(formAlert, 'danger', '{{ 'error_occurred'|trans }}');
                } finally {
                    // Reset button state
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>{{ 'send_message'|trans }}';
                }
            });

            // Quote Form Handler
            const quoteForm = document.getElementById('quoteForm');
            const quoteAlert = document.getElementById('quoteAlert');
            const quoteBtn = document.getElementById('quoteBtn');
            const quoteService = document.getElementById('quoteService');
            const quotePackage = document.getElementById('quotePackage');
            const quotePrice = document.getElementById('quotePrice');
            const quoteFinalPrice = document.getElementById('quoteFinalPrice');

            // Price calculator for quote form
            function calculateQuotePrice() {
                const service = quoteService.options[quoteService.selectedIndex];
                const package = quotePackage.options[quotePackage.selectedIndex];

                if (service.value && package.value) {
                    const basePrice = parseInt(service.dataset.price);
                    const multiplier = parseFloat(package.dataset.multiplier);
                    const total = Math.round(basePrice * multiplier);

                    quoteFinalPrice.textContent = total.toLocaleString();
                    quotePrice.style.display = 'block';
                } else {
                    quotePrice.style.display = 'none';
                }
            }

            quoteService.addEventListener('change', calculateQuotePrice);
            quotePackage.addEventListener('change', calculateQuotePrice);

            quoteForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(quoteForm);
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    service: formData.get('service'),
                    package: formData.get('package')
                };

                quoteBtn.disabled = true;
                quoteBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>{{ 'processing'|trans }}...';

                try {
                    const response = await fetch('/api/quote', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        showAlert(quoteAlert, 'success', result.message);
                        quoteForm.reset();
                        quotePrice.style.display = 'none';
                    } else {
                        showAlert(quoteAlert, 'danger', result.message);
                    }
                } catch (error) {
                    showAlert(quoteAlert, 'danger', '{{ 'error_occurred'|trans }}');
                } finally {
                    quoteBtn.disabled = false;
                    quoteBtn.innerHTML = '<i class="fas fa-calculator me-2"></i>{{ 'get_quote'|trans }}';
                }
            });

            // Alert helper function
            function showAlert(alertElement, type, message) {
                alertElement.className = `alert alert-${type}`;
                alertElement.textContent = message;
                alertElement.classList.remove('d-none');
                
                // Auto hide after 5 seconds
                setTimeout(() => {
                    alertElement.classList.add('d-none');
                }, 5000);
            }
        });
    </script>
{% endblock %}